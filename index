<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tienda Online</title>

<!-- reCAPTCHA -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<style>
body { font-family: Arial; padding:20px; background:#f4f4f4; }
.product { background:white; padding:15px; margin:10px; border-radius:8px; }
button { padding:8px 12px; margin-top:5px; cursor:pointer; }
.cart { background:white; padding:15px; margin-top:20px; border-radius:8px; }
input { display:block; margin:5px 0; padding:8px; width:100%; }
</style>
</head>

<body>

<h1>Tienda Online</h1>

<div id="products"></div>

<div class="cart">
<h2>Carrito</h2>
<div id="cartItems"></div>
<h3>Total: $<span id="total">0</span></h3>

<h3>Datos de envío</h3>
<input id="name" placeholder="Nombre completo">
<input id="email" placeholder="Correo">
<input id="phone" placeholder="Teléfono">
<input id="address" placeholder="Dirección completa">

<!-- AQUI VA TU SITE KEY -->
<div class="g-recaptcha" data-sitekey="6Lfwk3YsAAAAAFeGlDcaJ-mR1RWpAeKRSy7PYj7c"></div>

<button onclick="sendOrder()">Enviar Pedido</button>

<p id="status"></p>
</div>

<script>
const WEBAPP_URL = "https://script.google.com/a/macros/quikitgt.com/s/AKfycbzOr_uZtVE8EvHbJe1T5a1BWvCC4yyDxtLjZqvV4cp0JxaPdIrSwQOhKiv6fuDrDqLxfw/exec";
const SECRET_TOKEN = "sex";

const products = [
{id:1,name:"Camiseta",price:20},
{id:2,name:"Taza",price:10},
{id:3,name:"Libreta",price:8},
{id:4,name:"Mochila",price:40},
{id:5,name:"Gorra",price:15},
{id:6,name:"Stickers",price:5},
];

let cart = [];

function renderProducts(){
const container = document.getElementById("products");
products.forEach(p=>{
const div=document.createElement("div");
div.className="product";
div.innerHTML=`
<h3>${p.name}</h3>
<p>$${p.price}</p>
<button onclick="addToCart(${p.id})">Agregar</button>
`;
container.appendChild(div);
});
}

function addToCart(id){
const product=products.find(p=>p.id===id);
cart.push(product);
renderCart();
}

function renderCart(){
const cartDiv=document.getElementById("cartItems");
cartDiv.innerHTML="";
let total=0;
cart.forEach(p=>{
total+=p.price;
cartDiv.innerHTML+=`<p>${p.name} - $${p.price}</p>`;
});
document.getElementById("total").innerText=total;
}

async function sendOrder(){
const recaptcha = grecaptcha.getResponse();
if(!recaptcha){
document.getElementById("status").innerText="Confirma que no eres robot.";
return;
}

const order = {
secret: SECRET_TOKEN,
customer:{
name: document.getElementById("name").value,
email: document.getElementById("email").value,
phone: document.getElementById("phone").value,
address: document.getElementById("address").value
},
items: cart,
total: document.getElementById("total").innerText,
recaptchaToken: recaptcha
};

document.getElementById("status").innerText="Enviando...";

const res = await fetch(WEBAPP_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(order)
});

const data = await res.json();

if(data.ok){
document.getElementById("status").innerText="Pedido enviado!";
cart=[];
renderCart();
grecaptcha.reset();
}else{
document.getElementById("status").innerText="Error: "+data.error;
}
}

renderProducts();
</script>

</body>
</html>